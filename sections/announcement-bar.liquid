{% if section.blocks.size > 0 %}
  <div class="announcement-bar" data-section-id="{{ section.id }}" data-section-type="announcement-bar">
    <div class="announcement-slider">
      {% for block in section.blocks %}
        {% case block.type %}
          {% when 'announcement' %}
            <div class="announcement-bar__message" {{ block.shopify_attributes }}>
              {% if block.settings.link != blank %}
                <a href="{{ block.settings.link }}">
              {% endif %}
                {{ block.settings.text | escape }}
              {% if block.settings.link != blank %}
                </a>
              {% endif %}
            </div>
        {% endcase %}
      {% endfor %}
    </div>
  </div>
{% endif %}

{% schema %}
{
  "name": "Announcement bar",
  "max_blocks": 3,
  "blocks": [
    {
      "type": "announcement",
      "name": "Announcement",
      "settings": [
        {
          "type": "text",
          "id": "text",
          "label": "Text",
          "default": "Welcome to Albaprive"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Link",
          "info": "Optional"
        }
      ]
    }
  ],
  "default": {
    "blocks": [
      {
        "type": "announcement"
      }
    ]
  }
}
{% endschema %}

{% stylesheet %}
.announcement-bar {
  background: var(--color-base-accent-1);
  color: #ffffff;
  text-align: center;
  padding: 10px 0;
  font-size: 0.9em;
}

.announcement-bar__message {
  margin: 0;
}

.announcement-bar__message a {
  color: inherit;
  text-decoration: none;
}

.announcement-slider {
  position: relative;
}
{% endstylesheet %}

{% javascript %}
class AnnouncementSlider {
  constructor(container) {
    this.container = container;
    this.slides = container.querySelectorAll('.announcement-bar__message');
    if (this.slides.length > 1) {
      this.currentSlide = 0;
      this.init();
    }
  }

  init() {
    setInterval(() => this.nextSlide(), 5000);
  }

  nextSlide() {
    this.slides[this.currentSlide].style.display = 'none';
    this.currentSlide = (this.currentSlide + 1) % this.slides.length;
    this.slides[this.currentSlide].style.display = 'block';
  }
}

document.addEventListener('DOMContentLoaded', () => {
  const sliders = document.querySelectorAll('[data-section-type="announcement-bar"]');
  sliders.forEach(slider => new AnnouncementSlider(slider));
});
{% endjavascript %}
